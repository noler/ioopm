#include "db.h"
#include "utils.h"
#include "list.h"
#include "tree.h"

#include <stdio.h>
#include <ctype.h>
#include <stdlib.h>

extern void debug_print_tree(tree_t*);

void print_menu();
char get_menu_selection();

int* allocint(int value) {
	int* result = malloc(sizeof(int));
	*result = value;
	return result;
}

int main(int argc, char* argv[]) {
	tree_t* tree = tree_new();

	tree_insert(tree, allocint(9), allocint(9), tree_comp_int);
	tree_insert(tree, allocint(3), allocint(3), tree_comp_int);
	tree_insert(tree, allocint(1), allocint(1), tree_comp_int);
	tree_insert(tree, allocint(7), allocint(7), tree_comp_int);
	tree_insert(tree, allocint(6), allocint(6), tree_comp_int);
	tree_insert(tree, allocint(2), allocint(2), tree_comp_int);
	tree_insert(tree, allocint(8), allocint(8), tree_comp_int);
	tree_insert(tree, allocint(5), allocint(5), tree_comp_int);
	tree_insert(tree, allocint(10), allocint(10), tree_comp_int);
	tree_insert(tree, allocint(4), allocint(4), tree_comp_int);
	debug_print_tree(tree);

	for(int i = 1; i <= 10; i++) {
		printf("%d\n", *(int*) tree_search(tree, &i, tree_comp_int));
	}

	/*puts(
		"Välkommen till lagerhantering 1.0\n"
		"=================================\n");

	db_t* db = db_new();

	bool loop = true;
	while(loop) {
		print_menu();
		char c = get_menu_selection();

		switch(c) {
			case 'L': {
				item_t* item = db_item_input();
				db_add_item(db, item);
			}
			break;

			case 'T':
			{
				// TODO
			}
			break;

			case 'R':
			{
				// TODO
			}
			break;

			case 'G':
			{
				// TODO
			}
			break;

			case 'H':
				db_list(db);
				break;

			case 'A':
				loop = false;
				break;
		}
	}*/
}

void print_menu() {
	puts(
		"[L]ägga till en vara\n"
		"[T]a bort en vara\n"
		"[R]edigera en vara\n"
		"Ån[g]ra senaste ändringen\n"
		"List [h]ela varukatalogen\n"
		"[A]vsluta\n");
}

char get_menu_selection() {
	char c;
	do {
		fputs("Vad vill du göra? ", stdout);
		fflush(stdout);
		c = toupper(getchar());
		if(c == EOF) {
			return EOF;
		}
		char c2 = getchar();
		if(c2 != '\n' && c2 != EOF) {
			c = 0;
		}
	} while(
		c != 'L' &&
		c != 'T' &&
		c != 'R' &&
		c != 'G' &&
		c != 'H' &&
		c != 'A');

	return c;
}
